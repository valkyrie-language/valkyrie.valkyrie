# Valkyrie Bootstrap Compiler

Valkyrie è¯­è¨€è‡ªä¸¾ç¼–è¯‘å™¨ - ä½¿ç”¨ JavaScript å®ç°çš„ Valkyrie è¯­è¨€ç¼–è¯‘å™¨è‡ªä¸¾ç³»ç»Ÿã€‚

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®å®ç°äº†ä¸€ä¸ªå®Œæ•´çš„ Valkyrie è¯­è¨€ç¼–è¯‘å™¨è‡ªä¸¾ç³»ç»Ÿï¼Œèƒ½å¤Ÿç”¨ Valkyrie è¯­è¨€è‡ªèº«æ¥ç¼–å†™ç¼–è¯‘å™¨ï¼Œå¹¶é€šè¿‡è‡ªä¸¾è¿‡ç¨‹éªŒè¯ç¼–è¯‘å™¨çš„æ­£ç¡®æ€§å’Œä¸€è‡´æ€§ã€‚

### ğŸ—ï¸ é¡¹ç›®ç»“æ„

```tree
valkyrie-bootstrap/
â”œâ”€â”€ bootstrap/          # å½“å‰ç¼–è¯‘å™¨ï¼ˆå•ä¸ª JavaScript æ–‡ä»¶ï¼‰
â”‚   â””â”€â”€ index.js       # ç¼–è¯‘å™¨å…¥å£æ–‡ä»¶
â”œâ”€â”€ library/           # Valkyrie è¯­è¨€ç¼–å†™çš„ç¼–è¯‘å™¨æºä»£ç 
â”‚   â”œâ”€â”€ lexer/         # è¯æ³•åˆ†æå™¨æ¨¡å—
â”‚   â”œâ”€â”€ parser/        # è¯­æ³•åˆ†æå™¨æ¨¡å—
â”‚   â”œâ”€â”€ generation/    # ä»£ç ç”Ÿæˆå™¨æ¨¡å—
â”‚   â””â”€â”€ compiler/      # ç¼–è¯‘å™¨æ ¸å¿ƒæ¨¡å—
â”œâ”€â”€ dist/              # ç¼–è¯‘è¾“å‡ºç›®å½•
â”‚   â”œâ”€â”€ stage-0/       # ç¬¬ä¸€é˜¶æ®µç¼–è¯‘ç»“æœ
â”‚   â”œâ”€â”€ stage-1/       # ç¬¬äºŒé˜¶æ®µç¼–è¯‘ç»“æœ
â”‚   â””â”€â”€ *.js           # æµ‹è¯•ç¼–è¯‘è¾“å‡ºæ–‡ä»¶
â”œâ”€â”€ test/              # æµ‹è¯•æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ *.vk           # Valkyrie æµ‹è¯•æºæ–‡ä»¶
â”‚   â”œâ”€â”€ *.js           # é¢„æœŸç¼–è¯‘è¾“å‡º
â”‚   â””â”€â”€ */             # å¤æ‚æµ‹è¯•åœºæ™¯ç›®å½•
â”œâ”€â”€ bootstrap.js       # ä¸»å¼•å¯¼ç¨‹åº
â”œâ”€â”€ package.json       # é¡¹ç›®é…ç½®
â””â”€â”€ README.md         # é¡¹ç›®æ–‡æ¡£
```

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½

### è‡ªä¸¾ç¼–è¯‘æµç¨‹

#### é˜¶æ®µ 0: åˆå§‹ç¼–è¯‘
ä½¿ç”¨å½“å‰çš„ç¼–è¯‘å™¨ï¼ˆ`bootstrap/index.js`ï¼‰æ¥ç¼–è¯‘ `library/` ç›®å½•ä¸­çš„ Valkyrie è¯­è¨€æºä»£ç ï¼š

```javascript
// åŠ è½½å½“å‰ç¼–è¯‘å™¨
const bootstrapCompiler = await import('./bootstrap/index.js');

// ä½¿ç”¨ generateSingleJS å‡½æ•°ç”Ÿæˆ stage-0 ç¼–è¯‘å™¨
const result = bootstrapCompiler.package_compiler_generate_single_js(libraryFiles);
fs.writeFileSync('./dist/stage-0/index.js', result);
```

#### é˜¶æ®µ 1: è‡ªä¸¾éªŒè¯
ä½¿ç”¨é˜¶æ®µ 0 ç”Ÿæˆçš„ç¼–è¯‘å™¨å†æ¬¡ç¼–è¯‘ç›¸åŒçš„æºä»£ç ï¼š

```javascript
// åŠ è½½é˜¶æ®µ 0 ç¼–è¯‘å™¨
const stage0Compiler = await import('./dist/stage-0/index.js');

// å†æ¬¡ç¼–è¯‘ library/ ç›®å½•ç”Ÿæˆ stage-1 ç¼–è¯‘å™¨
const result = stage0Compiler.package_compiler_generate_single_js(libraryFiles);
fs.writeFileSync('./dist/stage-1/index.js', result);
```

#### é˜¶æ®µ 2: ä¸€è‡´æ€§éªŒè¯
æ¯”è¾ƒé˜¶æ®µ 0 å’Œé˜¶æ®µ 1 ç”Ÿæˆçš„ç¼–è¯‘å™¨æ–‡ä»¶ï¼Œç¡®ä¿å®ƒä»¬å®Œå…¨ä¸€è‡´ï¼š

```javascript
// æ¯”è¾ƒä¸¤ä¸ªé˜¶æ®µçš„è¾“å‡º
const stage0Content = fs.readFileSync('./dist/stage-0/index.js', 'utf8');
const stage1Content = fs.readFileSync('./dist/stage-1/index.js', 'utf8');

if (stage0Content === stage1Content) {
    // è‡ªä¸¾æˆåŠŸï¼ç”¨æ–°ç”Ÿæˆçš„ç¼–è¯‘å™¨æ›¿æ¢æ—§çš„
    fs.copyFileSync('./dist/stage-1/index.js', './bootstrap/index.js');
}
```

### ç¼–è¯‘å™¨æ¶æ„

#### æ ¸å¿ƒæ¨¡å—

1. **è¯æ³•åˆ†æå™¨ (Lexer)**
   - `library/lexer/ValkyrieLexer.valkyrie` - ä¸»è¯æ³•åˆ†æå™¨
   - `library/lexer/Token.valkyrie` - è¯æ³•å•å…ƒå®šä¹‰
   - æ”¯æŒ Unicode æ ‡è¯†ç¬¦å’Œç°ä»£è¯­æ³•ç‰¹æ€§

2. **è¯­æ³•åˆ†æå™¨ (Parser)**
   - `library/parser/ValkyrieParser.valkyrie` - ä¸»è¯­æ³•åˆ†æå™¨
   - `library/parser/Node.valkyrie` - AST èŠ‚ç‚¹å®šä¹‰
   - æ”¯æŒé€’å½’ä¸‹é™è§£æå’Œé”™è¯¯æ¢å¤

3. **ä»£ç ç”Ÿæˆå™¨ (Code Generation)**
   - `library/generation/JsCodeGeneration.valkyrie` - JavaScript ä»£ç ç”Ÿæˆ
   - æ”¯æŒ ES6+ è¯­æ³•å’Œç°ä»£ JavaScript ç‰¹æ€§

4. **ç¼–è¯‘å™¨æ ¸å¿ƒ (Compiler Core)**
   - `library/compiler/Compiler.valkyrie` - ä¸»ç¼–è¯‘å™¨ç±»
   - `library/compiler/CompilerOptions.valkyrie` - ç¼–è¯‘é€‰é¡¹
   - `library/compiler/CompilerDiagnostics.valkyrie` - è¯Šæ–­ç³»ç»Ÿ
   - `library/compiler/DependencyAnalyzer.valkyrie` - ä¾èµ–åˆ†æ
   - `library/compiler/NamespaceManager.valkyrie` - å‘½åç©ºé—´ç®¡ç†

## ğŸ› ï¸ ä½¿ç”¨æ–¹å¼

### è¿è¡Œå®Œæ•´çš„è‡ªä¸¾è¿‡ç¨‹

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
pnpm run boot

# æˆ–è€…åœ¨é¡¹ç›®ç›®å½•å†…
node bootstrap.js bootstrap
```

### ç¼–è¯‘å•ä¸ªæ–‡ä»¶

```bash
# ç¼–è¯‘ Valkyrie æºæ–‡ä»¶
node bootstrap.js compile <file.vk>
node bootstrap.js compile <file.valkyrie>

# è¾“å‡ºåˆ°æŒ‡å®šæ–‡ä»¶
node bootstrap.js compile input.vk -o output.js
```

### è¿è¡Œæµ‹è¯•å¥—ä»¶

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
node bootstrap.js test

# ä½¿ç”¨ stage-0 ç¼–è¯‘å™¨æµ‹è¯•
node bootstrap.js test --stage-0

# æµ‹è¯•ç‰¹å®šæ–‡ä»¶
node bootstrap.js test test/simple.vk
```

### æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯

```bash
node bootstrap.js help
```

## ğŸ“Š æµ‹è¯•è¦†ç›–

é¡¹ç›®åŒ…å«å…¨é¢çš„æµ‹è¯•å¥—ä»¶ï¼Œè¦†ç›–ä»¥ä¸‹åœºæ™¯ï¼š

### åŸºç¡€åŠŸèƒ½æµ‹è¯•
- `test/simple.vk` - åŸºç¡€è¯­æ³•æµ‹è¯•
- `test/variables.vk` - å˜é‡å£°æ˜å’Œä½œç”¨åŸŸ
- `test/function.vk` - å‡½æ•°å®šä¹‰å’Œè°ƒç”¨
- `test/class.vk` - ç±»å’Œå¯¹è±¡ç³»ç»Ÿ

### é«˜çº§ç‰¹æ€§æµ‹è¯•
- `test/namespace_*.vk` - å‘½åç©ºé—´ç³»ç»Ÿ
- `test/import_test.vk` - æ¨¡å—å¯¼å…¥
- `test/anonymous_function_test.vk` - åŒ¿åå‡½æ•°
- `test/implicit_member_call_test.vk` - éšå¼æˆå‘˜è°ƒç”¨

### å¤æ‚åœºæ™¯æµ‹è¯•
- `test/multifile_analysis_test.vk` - å¤šæ–‡ä»¶åˆ†æ
- `test/circular_dependency_test/` - å¾ªç¯ä¾èµ–å¤„ç†
- `test/complex_dependency_test/` - å¤æ‚ä¾èµ–å…³ç³»
- `test/enhanced_multifile_test/` - å¢å¼ºå¤šæ–‡ä»¶æ”¯æŒ

## ğŸ¯ è‡ªä¸¾æˆåŠŸæ¡ä»¶

1. **è¯­æ³•ä¸€è‡´æ€§**: å½“å‰ç¼–è¯‘å™¨å¿…é¡»èƒ½æ­£ç¡®è§£ææ‰€æœ‰ Valkyrie è¯­è¨€æºä»£ç 
2. **è¯­ä¹‰ä¸€è‡´æ€§**: ç”Ÿæˆçš„ç¼–è¯‘å™¨å¿…é¡»ä¿æŒç›¸åŒçš„è¯­ä¹‰è¡Œä¸º
3. **è¾“å‡ºä¸€è‡´æ€§**: ä¸¤ä¸ªé˜¶æ®µç”Ÿæˆçš„ç¼–è¯‘å™¨æ–‡ä»¶å¿…é¡»å®Œå…¨ç›¸åŒ
4. **åŠŸèƒ½å®Œæ•´æ€§**: æ–°ç”Ÿæˆçš„ç¼–è¯‘å™¨å¿…é¡»èƒ½å¤„ç†æ‰€æœ‰è¯­è¨€ç‰¹æ€§
5. **æµ‹è¯•é€šè¿‡**: æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹å¿…é¡»åœ¨æ–°ç¼–è¯‘å™¨ä¸‹æ­£å¸¸é€šè¿‡

## ğŸ”§ æŠ€æœ¯ç‰¹ç‚¹

### å•æ–‡ä»¶ç¼–è¯‘å™¨è®¾è®¡
- **è‡ªåŒ…å«**: æ‰€æœ‰åŠŸèƒ½æ‰“åŒ…åœ¨å•ä¸ª JavaScript æ–‡ä»¶ä¸­
- **é›¶ä¾èµ–**: ä¸ä¾èµ–å¤–éƒ¨åº“æˆ–è¿è¡Œæ—¶
- **å¯ç§»æ¤**: å¯ä»¥åœ¨ä»»ä½•æ”¯æŒ JavaScript çš„ç¯å¢ƒä¸­è¿è¡Œ

### Valkyrie è¯­è¨€å®ç°
- **è‡ªæè¿°**: ç¼–è¯‘å™¨ç”¨ç›®æ ‡è¯­è¨€è‡ªèº«ç¼–å†™
- **æ¨¡å—åŒ–**: æ¸…æ™°çš„æ¨¡å—åˆ†ç¦»å’ŒèŒè´£åˆ’åˆ†
- **å¯æ‰©å±•**: æ˜“äºæ·»åŠ æ–°ç‰¹æ€§å’Œä¼˜åŒ–

### é”™è¯¯å¤„ç†å’Œè¯Šæ–­
- **è¯¦ç»†é”™è¯¯ä¿¡æ¯**: åŒ…å«è¡Œåˆ—å·å’Œä¸Šä¸‹æ–‡
- **é”™è¯¯æ¢å¤**: è¯­æ³•é”™è¯¯åç»§ç»­è§£æ
- **è¯Šæ–­æŠ¥å‘Š**: ç¼–è¯‘è¿‡ç¨‹å’Œç»“æœçš„è¯¦ç»†ç»Ÿè®¡

## ğŸ“ˆ å½“å‰çŠ¶æ€

### âœ… å·²å®ŒæˆåŠŸèƒ½
- åŸºç¡€è¯æ³•åˆ†æå’Œè¯­æ³•åˆ†æ
- ç±»ã€å‡½æ•°ã€å˜é‡å£°æ˜
- å‘½åç©ºé—´å’Œæ¨¡å—ç³»ç»Ÿ
- JavaScript ä»£ç ç”Ÿæˆ
- è‡ªä¸¾ç¼–è¯‘æµç¨‹
- å®Œæ•´çš„æµ‹è¯•å¥—ä»¶

### ğŸ”„ å¼€å‘ä¸­åŠŸèƒ½
- ç±»å‹ç³»ç»Ÿå¢å¼º
- æ€§èƒ½ä¼˜åŒ–
- æ›´å¤šç›®æ ‡è¯­è¨€æ”¯æŒ
- IDE é›†æˆæ”¯æŒ

### ğŸ“‹ æœªæ¥è®¡åˆ’
- WebAssembly ç›®æ ‡æ”¯æŒ
- LLVM åç«¯é›†æˆ
- é«˜çº§ä¼˜åŒ–æŠ€æœ¯
- æ ‡å‡†åº“å®Œå–„

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **è‡ªä¸¾å¤±è´¥**
   - æ£€æŸ¥ `library/` ç›®å½•ä¸­çš„è¯­æ³•é”™è¯¯
   - éªŒè¯å½“å‰ç¼–è¯‘å™¨çš„å®Œæ•´æ€§
   - æŸ¥çœ‹ `dist/` ç›®å½•ä¸­çš„å·®å¼‚æ–‡ä»¶

2. **æµ‹è¯•å¤±è´¥**
   - ç¡®è®¤æµ‹è¯•æ–‡ä»¶è¯­æ³•æ­£ç¡®
   - æ£€æŸ¥é¢„æœŸè¾“å‡ºæ–‡ä»¶æ˜¯å¦åŒ¹é…
   - ä½¿ç”¨ `--stage-0` é€‰é¡¹å¯¹æ¯”ä¸åŒç¼–è¯‘å™¨ç‰ˆæœ¬

3. **ç¼–è¯‘é”™è¯¯**
   - éªŒè¯è¾“å…¥æ–‡ä»¶è¯­æ³•
   - æ£€æŸ¥ä¾èµ–å…³ç³»æ˜¯å¦æ­£ç¡®
   - æŸ¥çœ‹è¯¦ç»†çš„é”™è¯¯è¯Šæ–­ä¿¡æ¯

## ğŸ¤ è´¡çŒ®æŒ‡å—

æˆ‘ä»¬æ¬¢è¿æ‰€æœ‰å½¢å¼çš„è´¡çŒ®ï¼

1. **æŠ¥å‘Šé—®é¢˜**: åœ¨ GitHub Issues ä¸­æäº¤ bug æŠ¥å‘Š
2. **æäº¤æ”¹è¿›**: åˆ›å»º Pull Request æ”¹è¿›ä»£ç 
3. **æ·»åŠ æµ‹è¯•**: ä¸ºæ–°çš„è¯­è¨€ç‰¹æ€§æ·»åŠ æµ‹è¯•ç”¨ä¾‹
4. **æ–‡æ¡£å®Œå–„**: æ”¹è¿›æ–‡æ¡£å’Œæ³¨é‡Š

## ğŸ“ è”ç³»æ–¹å¼

- **é¡¹ç›®ä¸»é¡µ**: [GitHub Repository](https://github.com/nyar-lang/valkyrie-vm)
- **é—®é¢˜åé¦ˆ**: [GitHub Issues](https://github.com/nyar-lang/valkyrie-vm/issues)
- **æ–‡æ¡£ç«™ç‚¹**: [Valkyrie Documentation](https://valkyrie-document.netlify.app)

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯å¼€æº - è¯¦è§é¡¹ç›®æ ¹ç›®å½•çš„ [LICENSE.md](../LICENSE.md) æ–‡ä»¶ã€‚

---

**å‡†å¤‡å¥½æ¢ç´¢ç¼–è¯‘å™¨è‡ªä¸¾æŠ€æœ¯äº†å—ï¼Ÿ** ç«‹å³å¼€å§‹æ‚¨çš„ Valkyrie ç¼–è¯‘å™¨ä¹‹æ—…ï¼